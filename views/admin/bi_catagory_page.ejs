
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI settings</title>
    <%- include("../component/metadata.html") %> 
  




</head>

<body onload="pageLoadingTop()">

    <%- include("../component/admin-header-nav.html") %> 
    <%- include("../component/admin-menu-nav.html") %> 

    <div id="main-content" class="p-2 row mt-5">

            
            <%-include("../component/modal-trigger.html") %> 
      
            <%-include("../component/toast-ajax.html") %> 


<p></p>
  
  <form style="border: 1px solid black;" id="form_catagory"  method="post" >
              
    
     <div class="row"  id="">
         
    
        <div class=" col-10 col-md-6 m-auto btn-group" > 
                
            <input class=" form-dev"  type="text"  value="" name="catagory_name[]" id="" placeholder="Catagory name" required>
            <span class=" btn addItem">ADD</span>
            </div>
    
            
    </div>
    

    
           <div  class="row" id="catagoryAppend">
          
         
           </div>
    
    
    
           <p></p>
            
            <div class=" col-6 col-md-2 m-auto">
            <button  class="btn btn-secondary badge onsubmit w-100">Save</button>
            </div>
            <p></p>
   
 </form>
<p></p>

<div class="row">

    <div class="col-11 m-auto">

        <table class=" table table-hover">
            <thead>
              <tr>
                <th>Catagory</th>
                <th>Oparation</th>
              </tr>
            </thead>

            <tbody class="tbody-data">

            </tbody>
        </table>

    </div>

 </div>

 </div>



</body>

<script>


function init_get_data(){

    $.ajax({
        method: "post",
        url: "/admin/bi/catagory-get",
        data: {},
        dataType: "JSON",
        success: function (response) {
            
            $('.tbody-data').html(response.tbody_data);
        }
    });

}
init_get_data()


$(document).on("click", ".addItem", (e) => {
 
 $("#catagoryAppend").append(` 

 <div class=" col-10 col-md-6 m-auto btn-group" > 
                
        <input class=" form-dev"  type="text"  value="" name="catagory_name[]" id="" placeholder="Catagory name" required>
         <button type="button" class="btn btn-light addItem" title="ADD" ><i class="bi bi-plus-circle-fill text-primary"></i></button>
          <button type="button" class="btn btn-light removeItem" title="Remove" ><i class="bi bi-x-circle-fill text-danger"></i></button>

</div>
        
                
        </div>

    
 
 `)
 
 })

     $(document).on("click", ".removeItem", (e)=>{
          let thisItem= e.currentTarget.parentElement;
         
          $(thisItem).remove()
       
          
}) 


     

$(document).on('click', '.edit-btn', (event)=>{
   const catagory_id= event.currentTarget.attributes[0].value;
   $('.catagory_class'+catagory_id).attr('disabled', false);
   $('.update_'+catagory_id).html(`<button data-id="${catagory_id}" class="btn update-btn">Update</button>`)

})

$(document).on('click', '.update-btn', (event)=>{
    const catagory_id=event.currentTarget.attributes[0].value;
   const catagory_name=  $('.catagory_class'+catagory_id).val();

   $.ajax({
    method: "post",
    url: "/admin/bi/catagory-update-post",
    data: {catagory_id, catagory_name},
    dataType: "JSON",
    success: function (response) {
        
        init_get_data()
    }
   });

})




$(document).on('click', '.delete-btn', (event)=>{
    const catagory_id=event.currentTarget.attributes[0].value;
$('.modal-trigger-body').text('are you want to delete!?').addClass('alert alert-danger fw-bold')
$('.modal-trigger-trigger').click()
$('.modal-trigger-ok').click(()=>{
    $.ajax({
    method: "post",
    url: "/admin/bi/catagory-delete",
    data: {catagory_id},
    dataType: "JSON",
    success: function (response) {
        
        init_get_data()
    }
   });
})

$('.modal-trigger-cancel').click(()=>{
    init_get_data()
})

})





$('#form_catagory').on('submit', (event)=>{
event.preventDefault();

$.ajax({
    method: "post",
    url: "/admin/bi/catagory-post",
    data: $('#form_catagory').serialize(),
    dataType: "JSON",
    beforeSend: ()=>{

        $(".onsubmit").addClass("disabled")

    $('.toast-msg').html(`<img src="/image/default/loading-load.gif" width="100px" class=" bg-dark" alt="">
    <span>processing!</span>`)
    $('.toast').addClass('show');
 
},
success: function (response) {
    $(".onsubmit").removeClass("disabled")
    init_get_data()
    setTimeout(() => {
        $('.toast-btn').click()
    }, 100);
}
});
})



</script>

</html>